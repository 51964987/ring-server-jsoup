<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
<div th:fragment="onloadJS">

<script type="text/javascript" th:src="@{/lib/jquery/1.9.1/jquery.min.js}"></script>
<script type="text/javascript" th:src="@{/lib/jquery-ui/1.9.1/jquery-ui.min.js}"></script>
<script type="text/javascript" th:src="@{/h-ui/js/H-ui.js}"></script>
<script type="text/javascript">
	Date.prototype.Format = function (fmt) {  
	    var o = {  
	        "M+": this.getMonth() + 1, //月份   
	        "d+": this.getDate(), //日   
	        "H+": this.getHours(), //小时   
	        "m+": this.getMinutes(), //分   
	        "s+": this.getSeconds(), //秒   
	        "q+": Math.floor((this.getMonth() + 3) / 3), //季度   
	        "S": this.getMilliseconds() //毫秒   
	    };  
	    if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));  
	    for (var k in o)  
	    if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));  
	    return fmt;  
	}  
	function Page(){};
	$.extend(Page.prototype,{
		init:function(){
			this.bindEvents();
		},
		bindEvents:function(){
			//返回首页
			$.Huitotop();
			//Echart
			var _pageObject = this;
			$.ajaxSetup({
				cache: false,
		        timeout: 600000,
				beforeSend:function(){
					_pageObject.openEchartLoadingEvent();
				},
				complete:function(data){
					_pageObject.closeEchartLoadingEvent();
				},
				error:function(e){
					_pageObject.closeEchartLoadingEvent();
					//e.statusText()

				}
			});
		},
		openEchartLoadingEvent:function(data){
			$("[data-dom='echarts']").each(function(){
				var echartInstance = echarts.getInstanceByDom($(this)[0]);
				if(echartInstance != null){
					echartInstance.showLoading();
				}
			});
		},
		closeEchartLoadingEvent:function(data){
			$("[data-dom='echarts']").each(function(){
				var echartInstance = echarts.getInstanceByDom($(this)[0]);
				if(echartInstance != null){
					echartInstance.hideLoading();
				}
			});
		},
		waterMarkEvent:function(data){//水印
			var waterMarkText = 'RING'+new Date().Format("yyyyMMdd");
			var canvas = document.createElement('canvas');
			var ctx = canvas.getContext('2d');
			
			//canvas.width = canvas.height = 100;
			
			canvas.width = 118;
			canvas.height = 140;
			
			ctx.textAlign = 'center';
			ctx.textBaseline = 'middle';
			ctx.globalAlpha = 0.08;
			ctx.font = '20px Microsoft Yahei';
			ctx.translate(60, 60);
			ctx.rotate(-Math.PI / 4);
			ctx.fillText(waterMarkText,0,0);
			
			return canvas;
		},
		ajaxLoadSelectEvent:function(option){//下拉框异步加载数据 
			//data = {select:"#fid",url:/*[[@{/model/change}]]*/,def:{"key":"","value":"选择模块"},
			//map:{"key":"model","value":"modelName"},attrs:[{"key":"data-url","value":"modelUrl"}],
			//selected:"",
			//data:{"source":$("#source").val()},events:function(){}}
			var _source = $(option.select).html("");
			$("<option>")
			.attr({"value":option.def.key})
			.text(option.def.value)
			.appendTo(_source);
			var _attrs = option.attrs;
			$.post(option.url,option.data,function(data){
				$.each(data,function(i,json){
					var _option = $("<option>")
					.attr("value",json[option.map.key])
					.text(json[option.map.value])
					.appendTo(_source);
					for(var a in _attrs){
						_option.attr(_attrs[a].key,json[_attrs[a].value]);
					}
				});
				if( option.events!=null && option.events != "undefined"){
					option.events(option);
				}
				if( option.selected!=null && option.selected!= "undefined"){
					$(option.select).val(option.selected);
				}
			});
		}
	});
	var page;
	$(function(){
		page=new Page();
		page.init();
	});
</script>

</div>
</body>
</html>